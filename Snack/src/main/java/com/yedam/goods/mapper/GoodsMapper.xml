<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.goods.mapper.GoodsMapper">
<!-- 	<select id="selectList" resultType="goods">
		select * from goods
		<where>
			<if test = 'category != null'>
				category = #{category}
			</if>
		</where> order by 1
	</select> -->
	
 	<select id="selectList" resultType="goods">
		SELECT b.* FROM
		    (
		    SELECT ROWNUM rn, a.*
		    FROM
		        (
		        select * from goods
				<where>
				<if test = 'category != null'>
				category = #{category}
				</if>
				</where> order by 1
		        ) a
		    ) b
			<![CDATA[
			WHERE b.rn > (#{page}-1)*12 AND b.rn <= #{page}*12
			]]>
	</select>
	
 	<select id="selectOne" resultType="goods" parameterType="string">
		select * from goods where goods_code = #{gcode}
	</select>
	
 	<select id="selectSearch" resultType="goods">
 		SELECT b.* FROM
		    (
		    SELECT ROWNUM rn, a.*
		    FROM
		        (
		        select * from goods
				<where>
				<if test = 'keyword != null'>
				goods_name like '%'||#{keyword}||'%'
				</if>
				</where> order by 1
		        ) a
		    ) b
			<![CDATA[
			WHERE b.rn > (#{page}-1)*12 AND b.rn <= #{page}*12
			]]>
 	
<!--  		select * from goods where goods_name like '%'||#{keyword}||'%' order by 1 -->
	</select>
	
	<select id="selectCount" resultType="int">
		select count(*) from goods
		<where>
		<if test = 'category != null'>
		category = #{category}
		</if>
		<if test = 'keyword != null'>
		goods_name like '%'||#{keyword}||'%'
		</if>
		</where>
	</select>
	
 	<select id="selectRecommend" resultType="goods">
		select d.goods_code, count(d.goods_code) count, g.goods_name, g.price, g.thumb_image from detail d, goods g
		<where>
		d.goods_code = g.goods_code
		<if test = 'category != null'>
		and category = #{category}
		</if>
		</where> group by d.goods_code, g.goods_name, g.price, g.thumb_image order by 2 desc
	</select>
</mapper>